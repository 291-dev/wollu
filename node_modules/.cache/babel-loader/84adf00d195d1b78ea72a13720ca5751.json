{"ast":null,"code":"var __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n    r,\n    ar = [],\n    e;\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n  return ar;\n};\nimport { useState, useRef } from 'react';\nimport useIsomorphicLayoutEffect from 'use-isomorphic-layout-effect';\nimport useConstant from './useConstant';\nexport function isActorWithState(actorRef) {\n  return 'state' in actorRef;\n}\nfunction isDeferredActor(actorRef) {\n  return 'deferred' in actorRef;\n}\nvar noop = function noop() {\n  /* ... */\n};\nfunction defaultGetSnapshot(actorRef) {\n  return 'getSnapshot' in actorRef ? actorRef.getSnapshot() : isActorWithState(actorRef) ? actorRef.state : undefined;\n}\nexport function useActor(actorRef, getSnapshot) {\n  if (getSnapshot === void 0) {\n    getSnapshot = defaultGetSnapshot;\n  }\n  var actorRefRef = useRef(actorRef);\n  var deferredEventsRef = useRef([]);\n  var _a = __read(useState(function () {\n      return getSnapshot(actorRef);\n    }), 2),\n    current = _a[0],\n    setCurrent = _a[1];\n  var send = useConstant(function () {\n    return function () {\n      var args = [];\n      for (var _i = 0; _i < arguments.length; _i++) {\n        args[_i] = arguments[_i];\n      }\n      var event = args[0];\n      if (process.env.NODE_ENV !== 'production' && args.length > 1) {\n        console.warn(\"Unexpected payload: \".concat(JSON.stringify(args[1]), \". Only a single event object can be sent to actor send() functions.\"));\n      }\n      var currentActorRef = actorRefRef.current;\n      // If the previous actor is a deferred actor,\n      // queue the events so that they can be replayed\n      // on the non-deferred actor.\n      if (isDeferredActor(currentActorRef) && currentActorRef.deferred) {\n        deferredEventsRef.current.push(event);\n      } else {\n        currentActorRef.send(event);\n      }\n    };\n  });\n  useIsomorphicLayoutEffect(function () {\n    actorRefRef.current = actorRef;\n    setCurrent(getSnapshot(actorRef));\n    var subscription = actorRef.subscribe({\n      next: function next(emitted) {\n        return setCurrent(emitted);\n      },\n      error: noop,\n      complete: noop\n    });\n    // Dequeue deferred events from the previous deferred actorRef\n    while (deferredEventsRef.current.length > 0) {\n      var deferredEvent = deferredEventsRef.current.shift();\n      actorRef.send(deferredEvent);\n    }\n    return function () {\n      subscription.unsubscribe();\n    };\n  }, [actorRef]);\n  return [current, send];\n}","map":null,"metadata":{},"sourceType":"module"}